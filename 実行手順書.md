# 面接練習レポート支援ツール - 実行手順書

## 📌 このツールについて
教師と生徒の面接練習を録音・分析し、フィードバックレポートを自動生成するツールです。
完全無料・ローカル実行で、データは外部に送信されません。

---

## 🎯 クイックスタート（初回セットアップ済みの場合）

すでにセットアップが完了している場合は、以下の手順で起動できます。

### Windows (PowerShell)
```powershell
cd c:\00pro\mensetu_renshyuu

# 1. Ollamaを起動（別のPowerShellウィンドウで）
ollama serve

# 2. アプリケーションを起動
.\venv\Scripts\Activate.ps1
python app.py
```

### macOS/Linux
```bash
cd /path/to/mensetu_renshyuu

# 1. Ollamaを起動（別のターミナルで）
ollama serve

# 2. アプリケーションを起動
source venv/bin/activate
python app.py
```

### 3. ブラウザでアクセス
http://localhost:8000 を開く

---

## 🔧 初回セットアップ（まだ実行していない場合）

### 前提条件の確認

#### 1. Pythonのインストール確認
```powershell
python --version
```
**必要**: Python 3.9以上

Pythonがインストールされていない場合:
- https://www.python.org/downloads/ からダウンロードしてインストール

---

#### 2. FFmpegのインストール

**Windows (Chocolatey使用)**:
```powershell
choco install ffmpeg
```

**Windows (手動インストール)**:
1. https://ffmpeg.org/download.html からダウンロード
2. ダウンロードしたファイルを解凍
3. 環境変数 `PATH` に追加

**macOS**:
```bash
brew install ffmpeg
```

**Linux (Ubuntu/Debian)**:
```bash
sudo apt update
sudo apt install ffmpeg
```

**確認**:
```powershell
ffmpeg -version
```

---

#### 3. Ollamaのインストール

1. https://ollama.ai/ からダウンロード・インストール
2. モデルのダウンロード:
```powershell
ollama pull llama3.2
```

**確認**:
```powershell
ollama list
```

---

### セットアップ手順

#### ステップ1: プロジェクトディレクトリへ移動
```powershell
cd c:\00pro\mensetu_renshyuu
```

#### ステップ2: 仮想環境の作成と有効化

**Windows (PowerShell)**:
```powershell
# 仮想環境を作成
python -m venv venv

# 仮想環境を有効化
.\venv\Scripts\Activate.ps1
```

> **注意**: PowerShellの実行ポリシーでエラーが出る場合:
> ```powershell
> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
> ```

**macOS/Linux**:
```bash
# 仮想環境を作成
python3 -m venv venv

# 仮想環境を有効化
source venv/bin/activate
```

**確認**: プロンプトの先頭に `(venv)` が表示されればOK

---

#### ステップ3: 依存パッケージのインストール
```powershell
# pipのアップグレード
pip install --upgrade pip

# 必要なパッケージをインストール（5-10分かかります）
pip install -r requirements.txt
```

---

#### ステップ4: HuggingFace トークンの設定

1. https://huggingface.co/join でアカウント作成
2. https://huggingface.co/settings/tokens でトークン生成（Read権限）
3. `.env`ファイルを作成:

**Windows**:
```powershell
Copy-Item .env.example .env
notepad .env
```

**macOS/Linux**:
```bash
cp .env.example .env
nano .env
```

4. `.env`ファイルに以下を記述:
```
HUGGINGFACE_TOKEN=hf_xxxxxxxxxxxxxxxxxx
```
（`hf_xxxxxxxxxxxxxxxxxx` の部分を取得したトークンに置き換える）

---

#### ステップ5: データディレクトリの確認

**Windows**:
```powershell
# すでに存在するはずですが、念のため確認
if (!(Test-Path "data\uploads")) { New-Item -ItemType Directory -Path "data\uploads" }
if (!(Test-Path "data\reports")) { New-Item -ItemType Directory -Path "data\reports" }
```

**macOS/Linux**:
```bash
mkdir -p data/uploads data/reports
```

---

## ▶️ アプリケーションの起動

### 1. Ollamaを起動（別ウィンドウ/ターミナルで）

**Windows (PowerShell)**:
```powershell
ollama serve
```

**macOS/Linux**:
```bash
ollama serve
```

> **注意**: このウィンドウは開いたままにしておいてください。

---

### 2. アプリケーションを起動（メインウィンドウ）

**Windows (PowerShell)**:
```powershell
cd c:\00pro\mensetu_renshyuu
.\venv\Scripts\Activate.ps1
python app.py
```

**macOS/Linux**:
```bash
cd /path/to/mensetu_renshyuu
source venv/bin/activate
python app.py
```

---

### 3. ブラウザでアクセス

起動メッセージが表示されたら、ブラウザで以下のURLを開く:
```
http://localhost:8000
```

または
```
http://127.0.0.1:8000
```

---

## 📝 使い方

### 面接練習の実施手順

1. **録音開始**: 
   - ブラウザで「録音開始」ボタンをクリック
   - マイクへのアクセス許可を求められたら「許可」をクリック

2. **面接練習実施**: 
   - 教師役と生徒役で面接を実施
   - 音声がしっかり録音されるよう、明瞭に話す

3. **録音停止**: 
   - 面接が終わったら「録音停止」ボタンをクリック

4. **分析開始**: 
   - 「分析開始」ボタンをクリック
   - 処理には数分かかります（音声の長さに依存）

5. **レポート確認**: 
   - 分析が完了すると、レポートが自動的に表示されます
   - レポートには以下が含まれます：
     - 文字起こし結果
     - 話者分離（教師/生徒）
     - 日本語の補正提案
     - 音声分析（ピッチ、音量、話速、声のトーン）
     - 総合評価

---

## 🛑 アプリケーションの終了

### アプリケーションの停止
メインウィンドウで `Ctrl + C` を押す

### Ollamaの停止
Ollamaが起動しているウィンドウで `Ctrl + C` を押す

### 仮想環境の無効化
```powershell
deactivate
```

---

## ⚙️ 設定のカスタマイズ（オプション）

### Whisperモデルの変更
`.env`ファイルで以下を設定:
```
# 高速だが精度低: tiny, base
# バランス型: small, medium
# 高精度だが低速: large
WHISPER_MODEL=base
```

### GPU使用の有効化
CUDA対応GPUがある場合:
```powershell
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

---

## 🔍 トラブルシューティング

### 問題1: PowerShellで実行ポリシーエラー
**エラーメッセージ**: 「このシステムではスクリプトの実行が無効になっているため...」

**解決方法**:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

---

### 問題2: Ollamaに接続できない
**エラーメッセージ**: 「Ollamaに接続できません」

**確認方法**:
```powershell
ollama list
```

**解決方法**:
- 別のウィンドウで `ollama serve` を実行しているか確認
- Ollamaが正しくインストールされているか確認

---

### 問題3: HuggingFaceトークンエラー
**エラーメッセージ**: 「HuggingFace認証エラー」

**解決方法**:
1. `.env`ファイルが存在するか確認
2. トークンが正しく記述されているか確認
3. トークンに `Read` 権限があるか確認

---

### 問題4: 音声が録音されない
**確認項目**:
- ブラウザでマイクへのアクセスを許可しているか
- マイクが正しく接続されているか
- Windowsのプライバシー設定でマイクが有効になっているか

---

### 問題5: 処理が遅い
**対処方法**:
1. Whisperモデルを小さいものに変更（`.env`で`WHISPER_MODEL=tiny`）
2. GPU版PyTorchをインストール（上記参照）
3. CPUコア数の多いマシンを使用

---

## 📁 データの保存場所

- **録音ファイル**: `data/uploads/`
- **レポート**: `data/reports/`
- **データベース**: `data/interviews.db`

---

## 🆘 サポート

問題が解決しない場合は、以下を確認してください:
- [README.md](README.md) - 詳細なドキュメント
- [SETUP.md](SETUP.md) - セットアップガイド
- GitHub Issues: https://github.com/ootomonaiso/mensetu_renshyuu/issues

---

## 📊 システム要件

### 最小要件
- **OS**: Windows 10/11, macOS 10.15+, Linux
- **CPU**: 4コア
- **RAM**: 8GB
- **ストレージ**: 10GB以上の空き容量

### 推奨要件
- **CPU**: 8コア以上
- **RAM**: 16GB以上
- **GPU**: CUDA対応GPU（オプション、処理高速化）

---

## 📌 メモ

- 初回起動時はWhisperモデルのダウンロードが発生するため、時間がかかります
- インターネット接続は初回セットアップとモデルダウンロード時のみ必要
- セットアップ後はオフラインで動作可能
- 音声データは完全にローカルで処理され、外部に送信されません
